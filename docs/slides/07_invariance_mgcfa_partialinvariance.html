<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tommaso Feraco">

<title>Evaluating Measurement and Structural Invariance  via Multi-Group CFA – SEM-PhD</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="shortcut icon" href="../assets/images/faviconpsicostat2.png">

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SEM-PhD</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../slides/slides_index.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../labs/labs_index.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../glossary.html"> 
<span class="menu-text">Glossary</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../reporting-checklist.html"> 
<span class="menu-text">Reporting checklist</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../extras/extras_index.html"> 
<span class="menu-text">Extras</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/feracotommaso/SEM-phd-course"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#today-in-the-workflow" id="toc-today-in-the-workflow" class="nav-link active" data-scroll-target="#today-in-the-workflow">Today in the workflow</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning objectives</a></li>
  <li><a href="#a-hot-topic" id="toc-a-hot-topic" class="nav-link" data-scroll-target="#a-hot-topic">A hot topic</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#the-importance-of-measurement-invariance" id="toc-the-importance-of-measurement-invariance" class="nav-link" data-scroll-target="#the-importance-of-measurement-invariance">The importance of Measurement Invariance</a></li>
  <li><a href="#invariance-of-a-structural-equation-model" id="toc-invariance-of-a-structural-equation-model" class="nav-link" data-scroll-target="#invariance-of-a-structural-equation-model">Invariance of a Structural Equation Model</a></li>
  <li><a href="#assessing-invariance-the-multi-group-analysis" id="toc-assessing-invariance-the-multi-group-analysis" class="nav-link" data-scroll-target="#assessing-invariance-the-multi-group-analysis">Assessing invariance: the multi-group analysis</a></li>
  <li><a href="#the-starting-point-mg-cfa" id="toc-the-starting-point-mg-cfa" class="nav-link" data-scroll-target="#the-starting-point-mg-cfa">The starting point (MG-CFA)</a></li>
  <li><a href="#the-idea-constraints-ladder" id="toc-the-idea-constraints-ladder" class="nav-link" data-scroll-target="#the-idea-constraints-ladder">The idea (constraints ladder)</a></li>
  <li><a href="#invariance-steps-measurement" id="toc-invariance-steps-measurement" class="nav-link" data-scroll-target="#invariance-steps-measurement">Invariance steps (measurement)</a></li>
  <li><a href="#what-level-do-you-need-for-which-claim" id="toc-what-level-do-you-need-for-which-claim" class="nav-link" data-scroll-target="#what-level-do-you-need-for-which-claim">What level do you need for which claim?</a></li>
  <li><a href="#step-by-step-guide-summary" id="toc-step-by-step-guide-summary" class="nav-link" data-scroll-target="#step-by-step-guide-summary">Step-by-step guide (summary)</a></li>
  <li><a href="#mg-cfa-scheme-steps-14" id="toc-mg-cfa-scheme-steps-14" class="nav-link" data-scroll-target="#mg-cfa-scheme-steps-14">MG-CFA scheme (steps 1–4)</a></li>
  <li><a href="#to-read" id="toc-to-read" class="nav-link" data-scroll-target="#to-read">TO READ</a></li>
  <li><a href="#step-0-separate-models-for-each-group" id="toc-step-0-separate-models-for-each-group" class="nav-link" data-scroll-target="#step-0-separate-models-for-each-group">Step 0: Separate models for each group</a></li>
  <li><a href="#step-1-configural-invariance" id="toc-step-1-configural-invariance" class="nav-link" data-scroll-target="#step-1-configural-invariance">Step 1: Configural invariance</a></li>
  <li><a href="#step-1-configural-non-invariance" id="toc-step-1-configural-non-invariance" class="nav-link" data-scroll-target="#step-1-configural-non-invariance">Step 1: Configural (non-)invariance</a></li>
  <li><a href="#step-2-metric-invariance" id="toc-step-2-metric-invariance" class="nav-link" data-scroll-target="#step-2-metric-invariance">Step 2: Metric invariance</a></li>
  <li><a href="#step-2-metric-non-invariance" id="toc-step-2-metric-non-invariance" class="nav-link" data-scroll-target="#step-2-metric-non-invariance">Step 2: Metric (non-)invariance</a></li>
  <li><a href="#step-2-metric-non-invariance-1" id="toc-step-2-metric-non-invariance-1" class="nav-link" data-scroll-target="#step-2-metric-non-invariance-1">Step 2: Metric (non-)invariance</a></li>
  <li><a href="#step-3-scalar-invariance" id="toc-step-3-scalar-invariance" class="nav-link" data-scroll-target="#step-3-scalar-invariance">Step 3: Scalar invariance</a></li>
  <li><a href="#step-3-scalar-invariance-1" id="toc-step-3-scalar-invariance-1" class="nav-link" data-scroll-target="#step-3-scalar-invariance-1">Step 3: Scalar invariance</a></li>
  <li><a href="#step-4-invariance-of-observed-residual-variances" id="toc-step-4-invariance-of-observed-residual-variances" class="nav-link" data-scroll-target="#step-4-invariance-of-observed-residual-variances">Step 4: Invariance of observed residual variances</a></li>
  <li><a href="#step-4-invariance-of-observed-residual-variances-1" id="toc-step-4-invariance-of-observed-residual-variances-1" class="nav-link" data-scroll-target="#step-4-invariance-of-observed-residual-variances-1">Step 4: Invariance of observed residual variances</a></li>
  <li><a href="#step-5-invariance-of-latent-variances" id="toc-step-5-invariance-of-latent-variances" class="nav-link" data-scroll-target="#step-5-invariance-of-latent-variances">Step 5: Invariance of latent variances</a></li>
  <li><a href="#step-6-invariance-of-latent-covariances" id="toc-step-6-invariance-of-latent-covariances" class="nav-link" data-scroll-target="#step-6-invariance-of-latent-covariances">Step 6: Invariance of latent covariances</a></li>
  <li><a href="#step-7-invariance-of-latent-means" id="toc-step-7-invariance-of-latent-means" class="nav-link" data-scroll-target="#step-7-invariance-of-latent-means">Step 7: Invariance of latent means</a></li>
  <li><a href="#evaluation-global-comparison" id="toc-evaluation-global-comparison" class="nav-link" data-scroll-target="#evaluation-global-comparison">Evaluation: global comparison</a></li>
  <li><a href="#practical-comparison-rules" id="toc-practical-comparison-rules" class="nav-link" data-scroll-target="#practical-comparison-rules">Practical comparison rules</a></li>
  <li><a href="#partial-invariance-what-it-is" id="toc-partial-invariance-what-it-is" class="nav-link" data-scroll-target="#partial-invariance-what-it-is">Partial invariance (what it is)</a></li>
  <li><a href="#how-do-we-choose-what-to-free" id="toc-how-do-we-choose-what-to-free" class="nav-link" data-scroll-target="#how-do-we-choose-what-to-free">How do we choose what to free?</a></li>
  <li><a href="#live-coding-a-small-mg-cfa-example" id="toc-live-coding-a-small-mg-cfa-example" class="nav-link" data-scroll-target="#live-coding-a-small-mg-cfa-example">Live coding — a small MG-CFA example</a>
  <ul class="collapse">
  <li><a href="#cfa-model-toy" id="toc-cfa-model-toy" class="nav-link" data-scroll-target="#cfa-model-toy">CFA model (toy)</a></li>
  <li><a href="#step-0-separate-models-sanity-check" id="toc-step-0-separate-models-sanity-check" class="nav-link" data-scroll-target="#step-0-separate-models-sanity-check">Step 0 — Separate models (sanity check)</a></li>
  <li><a href="#step-1-configural-invariance-1" id="toc-step-1-configural-invariance-1" class="nav-link" data-scroll-target="#step-1-configural-invariance-1">Step 1 — Configural invariance</a></li>
  <li><a href="#step-2-metric-invariance-equal-loadings" id="toc-step-2-metric-invariance-equal-loadings" class="nav-link" data-scroll-target="#step-2-metric-invariance-equal-loadings">Step 2 — Metric invariance (equal loadings)</a></li>
  <li><a href="#step-2-diagnostics-what-breaks" id="toc-step-2-diagnostics-what-breaks" class="nav-link" data-scroll-target="#step-2-diagnostics-what-breaks">Step 2 diagnostics (what breaks?)</a></li>
  <li><a href="#step-3-scalar-invariance-loadings-intercepts" id="toc-step-3-scalar-invariance-loadings-intercepts" class="nav-link" data-scroll-target="#step-3-scalar-invariance-loadings-intercepts">Step 3 — Scalar invariance (loadings + intercepts)</a></li>
  <li><a href="#what-can-we-fix" id="toc-what-can-we-fix" class="nav-link" data-scroll-target="#what-can-we-fix">What can we fix?</a></li>
  <li><a href="#partial-invariance-in-lavaan" id="toc-partial-invariance-in-lavaan" class="nav-link" data-scroll-target="#partial-invariance-in-lavaan">Partial invariance in lavaan</a></li>
  <li><a href="#common-mistakes-invariance" id="toc-common-mistakes-invariance" class="nav-link" data-scroll-target="#common-mistakes-invariance">Common mistakes (invariance)</a></li>
  </ul></li>
  <li><a href="#case-study" id="toc-case-study" class="nav-link" data-scroll-target="#case-study">Case study</a>
  <ul class="collapse">
  <li><a href="#the-case-study-dataset" id="toc-the-case-study-dataset" class="nav-link" data-scroll-target="#the-case-study-dataset">The case study dataset</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a></li>
  <li><a href="#step-0-separate-models" id="toc-step-0-separate-models" class="nav-link" data-scroll-target="#step-0-separate-models">Step 0 — Separate models</a></li>
  <li><a href="#step-1-configural" id="toc-step-1-configural" class="nav-link" data-scroll-target="#step-1-configural">Step 1 — Configural</a></li>
  <li><a href="#step-2-metric" id="toc-step-2-metric" class="nav-link" data-scroll-target="#step-2-metric">Step 2 — Metric</a></li>
  <li><a href="#step-2-metric-1" id="toc-step-2-metric-1" class="nav-link" data-scroll-target="#step-2-metric-1">Step 2 — Metric</a></li>
  <li><a href="#step-3-scalar-and-partial-scalar" id="toc-step-3-scalar-and-partial-scalar" class="nav-link" data-scroll-target="#step-3-scalar-and-partial-scalar">Step 3 — Scalar and partial scalar</a></li>
  <li><a href="#step-3-scalar-and-partial-scalar-1" id="toc-step-3-scalar-and-partial-scalar-1" class="nav-link" data-scroll-target="#step-3-scalar-and-partial-scalar-1">Step 3 — Scalar and partial scalar</a></li>
  <li><a href="#step-3-inspection-of-equality-constraints" id="toc-step-3-inspection-of-equality-constraints" class="nav-link" data-scroll-target="#step-3-inspection-of-equality-constraints">Step 3 — Inspection of equality constraints</a></li>
  <li><a href="#step-3-partial-scalar-invariance" id="toc-step-3-partial-scalar-invariance" class="nav-link" data-scroll-target="#step-3-partial-scalar-invariance">Step 3 — Partial scalar invariance</a></li>
  <li><a href="#step-3-partial-scalar-invariance-1" id="toc-step-3-partial-scalar-invariance-1" class="nav-link" data-scroll-target="#step-3-partial-scalar-invariance-1">Step 3 — Partial scalar invariance</a></li>
  <li><a href="#what-does-partial-scalar-mean-interpretation" id="toc-what-does-partial-scalar-mean-interpretation" class="nav-link" data-scroll-target="#what-does-partial-scalar-mean-interpretation">What does partial scalar mean (interpretation)?</a></li>
  <li><a href="#invariance-of-residuals-of-observed-variables1" id="toc-invariance-of-residuals-of-observed-variables1" class="nav-link" data-scroll-target="#invariance-of-residuals-of-observed-variables1">Invariance of Residuals of observed variables(1)</a></li>
  <li><a href="#invariance-of-residuals-of-observed-variables-2" id="toc-invariance-of-residuals-of-observed-variables-2" class="nav-link" data-scroll-target="#invariance-of-residuals-of-observed-variables-2">Invariance of Residuals of observed variables (2)</a></li>
  <li><a href="#inspection-of-equality-constraints" id="toc-inspection-of-equality-constraints" class="nav-link" data-scroll-target="#inspection-of-equality-constraints">Inspection of equality constraints</a></li>
  <li><a href="#invariance-of-residuals-of-observed-variables-1" id="toc-invariance-of-residuals-of-observed-variables-1" class="nav-link" data-scroll-target="#invariance-of-residuals-of-observed-variables-1">Invariance of Residuals of observed variables (1)</a></li>
  <li><a href="#partial-invariance-of-residuals-of-observed-variables-2" id="toc-partial-invariance-of-residuals-of-observed-variables-2" class="nav-link" data-scroll-target="#partial-invariance-of-residuals-of-observed-variables-2">Partial Invariance of Residuals of observed variables (2)</a></li>
  <li><a href="#invariance-of-variance-of-latent-variables-1" id="toc-invariance-of-variance-of-latent-variables-1" class="nav-link" data-scroll-target="#invariance-of-variance-of-latent-variables-1">Invariance of Variance of latent variables (1)</a></li>
  <li><a href="#invariance-of-variance-of-latent-variables-2" id="toc-invariance-of-variance-of-latent-variables-2" class="nav-link" data-scroll-target="#invariance-of-variance-of-latent-variables-2">Invariance of Variance of latent variables (2)</a></li>
  <li><a href="#invariance-of-covariance-of-latent-variables-1" id="toc-invariance-of-covariance-of-latent-variables-1" class="nav-link" data-scroll-target="#invariance-of-covariance-of-latent-variables-1">Invariance of Covariance of latent variables (1)</a></li>
  <li><a href="#invariance-of-covariance-of-latent-variables2" id="toc-invariance-of-covariance-of-latent-variables2" class="nav-link" data-scroll-target="#invariance-of-covariance-of-latent-variables2">Invariance of Covariance of latent variables(2)</a></li>
  <li><a href="#invariance-of-means-of-latent-variables-1" id="toc-invariance-of-means-of-latent-variables-1" class="nav-link" data-scroll-target="#invariance-of-means-of-latent-variables-1">Invariance of Means of latent variables (1)</a></li>
  <li><a href="#invariance-of-means-of-latent-variables-2" id="toc-invariance-of-means-of-latent-variables-2" class="nav-link" data-scroll-target="#invariance-of-means-of-latent-variables-2">Invariance of Means of latent variables (2)</a></li>
  <li><a href="#summing-up" id="toc-summing-up" class="nav-link" data-scroll-target="#summing-up">Summing up</a></li>
  <li><a href="#structural-invariance" id="toc-structural-invariance" class="nav-link" data-scroll-target="#structural-invariance">Structural invariance</a></li>
  <li><a href="#exercise-connect-to-the-lab" id="toc-exercise-connect-to-the-lab" class="nav-link" data-scroll-target="#exercise-connect-to-the-lab">Exercise (connect to the lab)</a></li>
  <li><a href="#take-home-3-things" id="toc-take-home-3-things" class="nav-link" data-scroll-target="#take-home-3-things">Take-home: 3 things</a></li>
  <li><a href="#further-reading-extras" id="toc-further-reading-extras" class="nav-link" data-scroll-target="#further-reading-extras">Further reading (extras)</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="07_invariance_mgcfa_partialinvariance.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Evaluating Measurement and Structural Invariance <br>via Multi-Group CFA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tommaso Feraco </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="today-in-the-workflow" class="level2">
<h2 class="anchored" data-anchor-id="today-in-the-workflow">Today in the workflow</h2>
<p>Specify → Identify → <strong>Estimate → Evaluate → Revise/Report</strong></p>
<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>Today we focus on:</p>
<ul>
<li><strong>Evaluate</strong>: “Does the <em>same</em> measurement model hold across groups?”</li>
<li><strong>Report</strong>: “What level of invariance supports which claims?”</li>
</ul>
</div>
</div>
</div>
<p>In particular:</p>
<ul>
<li>Why measurement invariance is a <em>prerequisite</em> for group comparisons</li>
<li>The MG-CFA ladder (configural → metric → scalar → strict)</li>
<li>How to evaluate invariance (Δ fit + local diagnostics)</li>
<li>Partial invariance: what to free, how to justify it</li>
<li>(Briefly) structural invariance: variances/covariances/means</li>
</ul>
<hr>
</section>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning objectives</h2>
<p>By the end of this lesson you can:</p>
<ul>
<li>Explain <strong>configural / metric / scalar / strict</strong> invariance in plain language</li>
<li>Fit MG-CFA models in <code>lavaan</code> using <code>group.equal</code></li>
<li>Compare nested models using <strong>ΔCFI / ΔRMSEA / Δχ²</strong> (and know the limits)</li>
<li>Use <strong>score tests / modification indices</strong> to diagnose non-invariance</li>
<li>Implement <strong>partial invariance</strong> via <code>group.partial</code></li>
<li>State which inferences are valid under each invariance level</li>
</ul>
<hr>
</section>
<section id="a-hot-topic" class="level2">
<h2 class="anchored" data-anchor-id="a-hot-topic">A hot topic</h2>
<p><img src="../assets/images/scopus.jpg" class="img-fluid" style="width:94.0%"></p>
<hr>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="../assets/images/twit1.png" class="img-fluid" style="width:94.0%"></p>
</div><div class="column" style="width:50%;">
<p><img src="../assets/images/twit2.png" class="img-fluid" style="width:94.0%"></p>
</div>
</div>
<hr>
</section>
<section id="the-importance-of-measurement-invariance" class="level2">
<h2 class="anchored" data-anchor-id="the-importance-of-measurement-invariance">The importance of Measurement Invariance</h2>
<ul>
<li>Researchers often compare groups on psychological constructs, assuming instruments measure the <em>same</em> latent variables across groups.</li>
<li>This assumption is often untested.</li>
<li><strong>Measurement invariance is a prerequisite</strong> for meaningful comparisons across groups (and across time).</li>
</ul>
<p><img src="../assets/images/articolo.png" class="img-fluid" style="width:88.0%"></p>
<hr>
</section>
<section id="invariance-of-a-structural-equation-model" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-a-structural-equation-model">Invariance of a Structural Equation Model</h2>
<p>More generally, testing invariance evaluates to what extent a hypothesized SEM can be considered <strong>invariant</strong> (same parameters) across groups.</p>
<p>Invariance is commonly used for comparisons across:</p>
<ul>
<li>gender</li>
<li>age groups</li>
<li>clinical vs non-clinical</li>
<li>culture / language / nationality</li>
<li>time (longitudinal invariance)</li>
</ul>
<hr>
</section>
<section id="assessing-invariance-the-multi-group-analysis" class="level2">
<h2 class="anchored" data-anchor-id="assessing-invariance-the-multi-group-analysis">Assessing invariance: the multi-group analysis</h2>
<ul>
<li>Multi-group analysis is the most widely used method to assess invariance.</li>
<li>In this lesson we focus on <strong>CFA models</strong> (MG-CFA).</li>
<li>Logic: estimate the same model in multiple groups, then add equality constraints and check what breaks.</li>
</ul>
<hr>
</section>
<section id="the-starting-point-mg-cfa" class="level2">
<h2 class="anchored" data-anchor-id="the-starting-point-mg-cfa">The starting point (MG-CFA)</h2>
<p><img src="../assets/images/grafmulti.png" class="img-fluid" style="width:92.0%"></p>
<hr>
</section>
<section id="the-idea-constraints-ladder" class="level2">
<h2 class="anchored" data-anchor-id="the-idea-constraints-ladder">The idea (constraints ladder)</h2>
<ol type="1">
<li>Start with the same model in all groups (baseline: all structural parameters are <em>free</em> to vary across groups)<br>
</li>
<li>Add constraints (more restrictive models: loadings, intercepts, residual variances, … <em>fixed</em> to be equal)<br>
</li>
<li>Compare fit: does the constraint produce a meaningful worsening?</li>
</ol>
<hr>
</section>
<section id="invariance-steps-measurement" class="level2">
<h2 class="anchored" data-anchor-id="invariance-steps-measurement">Invariance steps (measurement)</h2>
<ol type="1">
<li><strong>Configural</strong>: same factor structure (same “form”)</li>
<li><strong>Metric / weak</strong>: equal loadings (Λ)</li>
<li><strong>Scalar / strong</strong>: equal intercepts (τ)</li>
<li><strong>Strict</strong>: equal residual variances (Θ)</li>
</ol>
<blockquote class="blockquote">
<p><strong>Scalar invariance</strong> (full or partial) is the gateway to <strong>latent mean</strong> comparisons.</p>
</blockquote>
<hr>
</section>
<section id="what-level-do-you-need-for-which-claim" class="level2">
<h2 class="anchored" data-anchor-id="what-level-do-you-need-for-which-claim">What level do you need for which claim?</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Claim / Comparison</th>
<th>Minimum invariance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Same factor structure (same “form”)</td>
<td>Configural</td>
</tr>
<tr class="even">
<td>Compare relations (regressions/correlations)</td>
<td>Metric (often)</td>
</tr>
<tr class="odd">
<td>Compare latent means</td>
<td>Scalar (often partial scalar)</td>
</tr>
<tr class="even">
<td>Compare observed means directly</td>
<td>Not recommended without invariance evidence</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="step-by-step-guide-summary" class="level2">
<h2 class="anchored" data-anchor-id="step-by-step-guide-summary">Step-by-step guide (summary)</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 31%">
<col style="width: 43%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Step</th>
<th>Model</th>
<th>Constrain</th>
<th>Compare to</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td>Separate CFAs</td>
<td>—</td>
<td>—</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td>Configural</td>
<td>—</td>
<td>—</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td>Metric</td>
<td>loadings</td>
<td>configural</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td>Scalar</td>
<td>loadings + intercepts</td>
<td>metric</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td>Strict</td>
<td>+ residual variances</td>
<td>scalar</td>
</tr>
<tr class="even">
<td style="text-align: left;">5–7</td>
<td>Structural invariance</td>
<td>lv variances/covariances/means</td>
<td>previous</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="mg-cfa-scheme-steps-14" class="level2">
<h2 class="anchored" data-anchor-id="mg-cfa-scheme-steps-14">MG-CFA scheme (steps 1–4)</h2>
<p><img src="../assets/images/mgcfa.jpg" class="img-fluid" style="width:90.0%"></p>
<p>Slide stolen from Psicostat’s meeting by <a href="https://psicostat.dpss.psy.unipd.it/meetings/psicostat33.html">Enrico Perinelli</a>.</p>
<hr>
</section>
<section id="to-read" class="level2">
<h2 class="anchored" data-anchor-id="to-read">TO READ</h2>
<p>All the next slides are inspired in large part from the following <a href="https://www.the100.ci/2024/01/10/a-casual-but-causal-take-on-measurement-invariance/?fbclid=IwAR2kcAPkq0i1IZXntLkcbeSoU1D-Pb_R45VBhJ4EOZUmY_Cv3T0ne6-KbNE">blog post</a></p>
</section>
<section id="step-0-separate-models-for-each-group" class="level2">
<h2 class="anchored" data-anchor-id="step-0-separate-models-for-each-group">Step 0: Separate models for each group</h2>
<p><img src="../assets/images/g0.png" class="img-fluid"></p>
</section>
<section id="step-1-configural-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-1-configural-invariance">Step 1: Configural invariance</h2>
<p><img src="../assets/images/g1.png" class="img-fluid"></p>
</section>
<section id="step-1-configural-non-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-1-configural-non-invariance">Step 1: Configural (non-)invariance</h2>
<p>Configural invariance means that the “form” of the models is the same in the groups of interest. Form entails both the number of latent variables and whether the loadings are non-zero to begin with.</p>
<p><img src="../assets/images/conf.png" class="img-fluid"></p>
</section>
<section id="step-2-metric-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric-invariance">Step 2: Metric invariance</h2>
<p><img src="../assets/images/g2.png" class="img-fluid"></p>
</section>
<section id="step-2-metric-non-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric-non-invariance">Step 2: Metric (non-)invariance</h2>
<p>Metric invariance means that for each item, the loading of the factor on the item is the same in the two groups (or, again more precisely, that we cannot reject the hypothesis that the loadings are the same).</p>
<p><img src="../assets/images/metric.png" class="img-fluid"></p>
</section>
<section id="step-2-metric-non-invariance-1" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric-non-invariance-1">Step 2: Metric (non-)invariance</h2>
<p>The source of group differences does not come from the latent variable!</p>
<p><img src="../assets/images/metric2.png" class="img-fluid"></p>
</section>
<section id="step-3-scalar-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-3-scalar-invariance">Step 3: Scalar invariance</h2>
<p><img src="../assets/images/g3.png" class="img-fluid"></p>
</section>
<section id="step-3-scalar-invariance-1" class="level2">
<h2 class="anchored" data-anchor-id="step-3-scalar-invariance-1">Step 3: Scalar invariance</h2>
<p>Scalar invariance means that for each item, the intercept is the same. This means that group differences in the item responses are fully accounted for by group differences in the latent construct.</p>
<p><img src="../assets/images/scalar.png" class="img-fluid"></p>
</section>
<section id="step-4-invariance-of-observed-residual-variances" class="level2">
<h2 class="anchored" data-anchor-id="step-4-invariance-of-observed-residual-variances">Step 4: Invariance of observed residual variances</h2>
<p>Residual invariance means that for each item, the residual variance—the variance of the ominous E pointing into the items—is the same. We can again phrase this statistically: if we regressed the item scores on the factor, then the variance of the remaining residual would be the same in the groups (i.e., there would be homoscedasticity).</p>
</section>
<section id="step-4-invariance-of-observed-residual-variances-1" class="level2">
<h2 class="anchored" data-anchor-id="step-4-invariance-of-observed-residual-variances-1">Step 4: Invariance of observed residual variances</h2>
<p><img src="../assets/images/g4.png" class="img-fluid"></p>
<p>The thing about the residual is that it captures everything that’s not explained in the model, and explaining changes in the amount of unexplained things seems a bit futile. Residual invariance is often not tested because it’s not necessary for latent mean comparisons. It’s a bit of an anticlimactic level to end on.</p>
</section>
<section id="step-5-invariance-of-latent-variances" class="level2">
<h2 class="anchored" data-anchor-id="step-5-invariance-of-latent-variances">Step 5: Invariance of latent variances</h2>
<p><img src="../assets/images/g5.png" class="img-fluid"></p>
</section>
<section id="step-6-invariance-of-latent-covariances" class="level2">
<h2 class="anchored" data-anchor-id="step-6-invariance-of-latent-covariances">Step 6: Invariance of latent covariances</h2>
<p><img src="../assets/images/g6.png" class="img-fluid"></p>
</section>
<section id="step-7-invariance-of-latent-means" class="level2">
<h2 class="anchored" data-anchor-id="step-7-invariance-of-latent-means">Step 7: Invariance of latent means</h2>
<p><img src="../assets/images/g7.png" class="img-fluid"></p>
<hr>
</section>
<section id="evaluation-global-comparison" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-global-comparison">Evaluation: global comparison</h2>
<p>Common ingredients:</p>
<ul>
<li>Model fit in the more constrained model (χ², RMSEA, CFI/TLI, SRMR)</li>
<li><strong>Change in fit</strong> vs less constrained model:
<ul>
<li>Δχ² (highly N-sensitive)</li>
<li>ΔCFI (often used)</li>
<li>ΔRMSEA / ΔSRMR (sometimes used)</li>
<li>ΔBIC (information criteria)</li>
</ul></li>
</ul>
<p>A marked worsening of fit indices indicates that the considered invariance model is too restrictive and thus must be rejected.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>make a comprehensive evaluation based on different fit indices, rather than on a single fit criterion.</p>
</div>
</div>
<hr>
</section>
<section id="practical-comparison-rules" class="level2">
<h2 class="anchored" data-anchor-id="practical-comparison-rules">Practical comparison rules</h2>
<p>Let MOD-A be a reference model and MOD-B a more restrictive model.</p>
<ul>
<li>Δχ² = χ²(B) − χ²(A) (N-sensitive; use with caution)</li>
<li>ΔCFI = CFI(B) − CFI(A)
<ul>
<li>heuristic: accept if ΔCFI &gt; −.01</li>
</ul></li>
<li>ΔBIC = BIC(B) − BIC(A)
<ul>
<li>negative values favor B</li>
</ul></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Pitfall:</strong> with robust estimators (e.g., MLR/WLSMV), the χ² difference test is not always the plain <code>anova()</code> test.</p>
</div>
</div>
<hr>
</section>
<section id="partial-invariance-what-it-is" class="level2">
<h2 class="anchored" data-anchor-id="partial-invariance-what-it-is">Partial invariance (what it is)</h2>
<p>When invariance is untenable at some level (metric/scalar/strict), you can allow <strong>some</strong> parameters to differ:</p>
<ul>
<li>Free non-invariant loadings/intercepts/residual variances</li>
<li>Keep most constraints to preserve comparability</li>
</ul>
<p>Options (in practice):</p>
<ol type="1">
<li>Free a small number of parameters (theory-driven)</li>
<li>Argue differences are negligible (rarely convincing)</li>
<li>Remove problematic indicators (last resort)</li>
<li>Conclude constructs are not comparable <em>with the current instrument</em> or <em>theoretically</em> (sometimes correct!)</li>
</ol>
<hr>
</section>
<section id="how-do-we-choose-what-to-free" class="level2">
<h2 class="anchored" data-anchor-id="how-do-we-choose-what-to-free">How do we choose what to free?</h2>
<ul>
<li>Inspect parameters by group (largest differences)</li>
<li>Inspect <strong>score tests / modification indices</strong> for constrained parameters</li>
<li>Free <strong>one at a time</strong> and re-evaluate</li>
<li>Always justify based on theory and measurement logic</li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Pitfall:</strong> “MI shopping” can overfit noise. Partial invariance must remain <em>interpretable</em>.</p>
</div>
</div>
<hr>
</section>
<section id="live-coding-a-small-mg-cfa-example" class="level1">
<h1>Live coding — a small MG-CFA example</h1>
<section id="cfa-model-toy" class="level2">
<h2 class="anchored" data-anchor-id="cfa-model-toy">CFA model (toy)</h2>
<p><img src="../assets/images/grafapp1.png" class="img-fluid" style="width:75.0%"></p>
<hr>
</section>
<section id="step-0-separate-models-sanity-check" class="level2">
<h2 class="anchored" data-anchor-id="step-0-separate-models-sanity-check">Step 0 — Separate models (sanity check)</h2>
<p>This is <strong>not</strong> configural invariance. It’s only: “Does the model work in each group?”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d[d<span class="sc">$</span>Group <span class="sc">==</span> <span class="dv">0</span>, ])</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d[d<span class="sc">$</span>Group <span class="sc">==</span> <span class="dv">1</span>, ])</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m0, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     cfi      tli     srmr    rmsea      bic      aic 
   1.000    1.021    0.034    0.000 5214.258 5162.428 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m1, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     cfi      tli     srmr    rmsea      bic      aic 
   0.945    0.910    0.040    0.050 7899.949 7841.867 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-1-configural-invariance-1" class="level2">
<h2 class="anchored" data-anchor-id="step-1-configural-invariance-1">Step 1 — Configural invariance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>m_all <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_all, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cfi       tli      srmr     rmsea       bic       aic 
    1.000     1.007     0.021     0.000 13070.106 13004.430 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>m_conf <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d, <span class="at">group =</span> <span class="st">"Group"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_conf, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cfi       tli      srmr     rmsea       bic       aic 
    0.976     0.961     0.034     0.035 13224.946 13032.295 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-2-metric-invariance-equal-loadings" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric-invariance-equal-loadings">Step 2 — Metric invariance (equal loadings)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>m_metr <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d, <span class="at">group =</span> <span class="st">"Group"</span>,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">group.equal =</span> <span class="st">"loadings"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cfi       tli      srmr     rmsea       bic       aic 
    0.976     0.967     0.038     0.032 13198.034 13027.276 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to configural</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_metr, m_conf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

       Df   AIC   BIC  Chisq Chisq diff RMSEA Df diff Pr(&gt;Chisq)
m_conf 26 13032 13225 35.392                                    
m_metr 31 13027 13198 40.373     4.9804     0       5     0.4183</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr, <span class="st">"cfi"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_conf, <span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cfi 
  0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr, <span class="st">"bic"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_conf, <span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    bic 
-26.912 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-2-diagnostics-what-breaks" class="level2">
<h2 class="anchored" data-anchor-id="step-2-diagnostics-what-breaks">Step 2 diagnostics (what breaks?)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Score tests for equality constraints</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestScore</span>(m_metr)<span class="sc">$</span>uni <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
univariate score tests:

   lhs op   rhs    X2 df p.value
1 .p2. == .p28. 2.336  1   0.126
2 .p3. == .p29. 0.310  1   0.578
3 .p4. == .p30. 0.877  1   0.349
4 .p6. == .p32. 1.798  1   0.180
5 .p7. == .p33. 0.227  1   0.634</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter table (useful for mapping constraint ids)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">parameterTable</span>(m_metr)[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, <span class="fu">c</span>(<span class="st">"lhs"</span>,<span class="st">"op"</span>,<span class="st">"rhs"</span>,<span class="st">"group"</span>,<span class="st">"free"</span>,<span class="st">"ustart"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   lhs op rhs group free ustart
1   f1 =~  x1     1    0      1
2   f1 =~  x2     1    1     NA
3   f1 =~  x3     1    2     NA
4   f1 =~  x4     1    3     NA
5   f2 =~  x5     1    0      1
6   f2 =~  x6     1    4     NA
7   f2 =~  x7     1    5     NA
8   x1 ~~  x1     1    6     NA
9   x2 ~~  x2     1    7     NA
10  x3 ~~  x3     1    8     NA
11  x4 ~~  x4     1    9     NA
12  x5 ~~  x5     1   10     NA
13  x6 ~~  x6     1   11     NA
14  x7 ~~  x7     1   12     NA
15  f1 ~~  f1     1   13     NA</code></pre>
</div>
</div>
<hr>
</section>
<section id="step-3-scalar-invariance-loadings-intercepts" class="level2">
<h2 class="anchored" data-anchor-id="step-3-scalar-invariance-loadings-intercepts">Step 3 — Scalar invariance (loadings + intercepts)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>m_scal <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d, <span class="at">group =</span> <span class="st">"Group"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">group.equal =</span> <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cfi       tli      srmr     rmsea       bic       aic 
    0.984     0.981     0.039     0.024 13168.052 13019.185 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_scal, m_metr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

       Df   AIC   BIC  Chisq Chisq diff RMSEA Df diff Pr(&gt;Chisq)
m_metr 31 13027 13198 40.373                                    
m_scal 36 13019 13168 42.283     1.9096     0       5     0.8615</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal, <span class="st">"cfi"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_metr, <span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cfi 
0.008 </code></pre>
</div>
</div>
</section>
<section id="what-can-we-fix" class="level2">
<h2 class="anchored" data-anchor-id="what-can-we-fix">What can we fix?</h2>
<p>Through the option <code>group.equal</code> , it is possible to constrain groups of parameters to be equal across groups in order to assess increasingly restrictive invariance hypotheses:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Constrained parameters</th>
<th>In R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Factor loadings</td>
<td><code>loadings</code></td>
</tr>
<tr class="even">
<td>Intercepts of manifest variables</td>
<td><code>intercepts</code></td>
</tr>
<tr class="odd">
<td>Residual variances of manifest variables</td>
<td><code>residuals</code></td>
</tr>
<tr class="even">
<td>Residual covariances of manifest variables</td>
<td><code>residual.covariances</code></td>
</tr>
<tr class="odd">
<td>Residual variances of latent variables</td>
<td><code>lv.variances</code></td>
</tr>
<tr class="even">
<td>Residual covariances of latent variable</td>
<td><code>lv.covariances</code></td>
</tr>
<tr class="odd">
<td>Intercepts/means of latent variables</td>
<td><code>means</code></td>
</tr>
<tr class="even">
<td>All regression coefficients</td>
<td><code>regressions</code></td>
</tr>
<tr class="odd">
<td>Thresholds</td>
<td><code>thresholds</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="partial-invariance-in-lavaan" class="level2">
<h2 class="anchored" data-anchor-id="partial-invariance-in-lavaan">Partial invariance in lavaan</h2>
<p><code>group.partial</code> allows selected parameters to differ.</p>
<p>Example: After the inspection of MI, we decided to estimate a model of partial metric invariance in which the loading of the item x5 is free to vary between groups::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>m_metr_p <span class="ot">&lt;-</span> <span class="fu">cfa</span>(m, <span class="at">data =</span> d, <span class="at">group =</span> <span class="st">"Group"</span>,</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">group.equal =</span> <span class="st">"loadings"</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">group.partial =</span> <span class="st">"f2 =~ x5"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr_p, fi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      cfi       tli      srmr     rmsea       bic       aic 
    0.976     0.967     0.038     0.032 13198.034 13027.276 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Which model should we compare this to, and why? How to we interpret the results of such a model?</p>
</blockquote>
<hr>
</section>
<section id="common-mistakes-invariance" class="level2">
<h2 class="anchored" data-anchor-id="common-mistakes-invariance">Common mistakes (invariance)</h2>
<ul>
<li>Comparing <strong>latent means</strong> without (partial) <strong>scalar invariance</strong></li>
<li>Freeing many parameters without theoretical rationale (“MI fishing”)</li>
<li>Ignoring identification choices (scaling, reference indicators, factor means)</li>
<li>Using automated helpers as a black box</li>
</ul>
<hr>
</section>
</section>
<section id="case-study" class="level1">
<h1>Case study</h1>
<section id="the-case-study-dataset" class="level2">
<h2 class="anchored" data-anchor-id="the-case-study-dataset">The case study dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/dmg.RData"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(dmg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   300 obs. of  10 variables:
 $ id       : int  1 2 3 4 5 6 7 8 9 10 ...
 $ diagnosis: Factor w/ 2 levels "manic","norming": 1 1 1 1 1 1 1 1 1 1 ...
 $ Info     : num  8.95 11.94 5.8 14.69 6 ...
 $ Sim      : num  9.34 9.93 6.64 17.72 6.56 ...
 $ Vocab    : num  12.39 4.57 6.03 13.21 7.83 ...
 $ Comp     : num  11.61 8.86 5.03 13.38 5.77 ...
 $ PicComp  : num  11.15 4.95 8.02 11.54 8.84 ...
 $ PicArr   : num  15.7 5.46 7.65 12.06 5.39 ...
 $ BlkDsgn  : num  11.45 3.43 9.28 10.46 7.39 ...
 $ ObjAsmb  : num  15.54 3.8 8.63 14.38 9.92 ...</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>SEM work with variance-covariance matrices. For this reason, it is sufficient to find it in the original articles to use their “data”! The data we will use have been generated based on the parameters provided in the article, modifying the sample size.</p>
</div>
</div>
<hr>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="st">gc =~ Info + Sim + Vocab + Comp</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="st">gv =~ PicComp + PicArr + BlkDsgn + ObjAsmb</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="step-0-separate-models" class="level2">
<h2 class="anchored" data-anchor-id="step-0-separate-models">Step 0 — Separate models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>m_man <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg[dmg<span class="sc">$</span>diagnosis <span class="sc">==</span> <span class="st">"manic"</span>, ])</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>m_nor <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg[dmg<span class="sc">$</span>diagnosis <span class="sc">==</span> <span class="st">"norming"</span>, ])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_man, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chisq     df  rmsea    cfi    tli 
54.052 19.000  0.111  0.949  0.924 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_nor, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chisq     df  rmsea    cfi    tli 
18.151 19.000  0.000  1.000  1.003 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-1-configural" class="level2">
<h2 class="anchored" data-anchor-id="step-1-configural">Step 1 — Configural</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>m_conf2 <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg, <span class="at">group =</span> <span class="st">"diagnosis"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_conf2, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chisq     df  rmsea    cfi    tli 
72.203 38.000  0.077  0.971  0.957 </code></pre>
</div>
</div>
<p><code>ANY COMMENTS?</code></p>
<hr>
</section>
<section id="step-2-metric" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric">Step 2 — Metric</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>m_metr2 <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg, <span class="at">group =</span> <span class="st">"diagnosis"</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">group.equal =</span> <span class="st">"loadings"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr2, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> chisq     df  rmsea    cfi    tli 
88.153 44.000  0.082  0.963  0.952 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-2-metric-1" class="level2">
<h2 class="anchored" data-anchor-id="step-2-metric-1">Step 2 — Metric</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_metr2, m_conf2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

        Df   AIC   BIC  Chisq Chisq diff   RMSEA Df diff Pr(&gt;Chisq)  
m_conf2 38 11239 11424 72.203                                        
m_metr2 44 11243 11406 88.153      15.95 0.10515       6    0.01402 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr2, <span class="st">"cfi"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_conf2, <span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.008 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_metr2, <span class="st">"bic"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_conf2, <span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    bic 
-18.272 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-3-scalar-and-partial-scalar" class="level2">
<h2 class="anchored" data-anchor-id="step-3-scalar-and-partial-scalar">Step 3 — Scalar and partial scalar</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>m_scal2 <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg, <span class="at">group =</span> <span class="st">"diagnosis"</span>,</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">group.equal =</span> <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>))</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal2, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi     tli 
144.667  50.000   0.112   0.920   0.910 </code></pre>
</div>
</div>
<p><code>COMMENTS</code></p>
<hr>
</section>
<section id="step-3-scalar-and-partial-scalar-1" class="level2">
<h2 class="anchored" data-anchor-id="step-3-scalar-and-partial-scalar-1">Step 3 — Scalar and partial scalar</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_scal2, m_metr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

        Df   AIC   BIC   Chisq Chisq diff   RMSEA Df diff Pr(&gt;Chisq)    
m_metr2 44 11243 11406  88.153                                          
m_scal2 50 11287 11428 144.667     56.513 0.23691       6  2.292e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal2, <span class="st">"cfi"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_metr2, <span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.043 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-3-inspection-of-equality-constraints" class="level2">
<h2 class="anchored" data-anchor-id="step-3-inspection-of-equality-constraints">Step 3 — Inspection of equality constraints</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the worst constraints</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestScore</span>(m_scal2)<span class="sc">$</span>uni <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
univariate score tests:

     lhs op   rhs     X2 df p.value
1   .p2. == .p31.  0.419  1   0.517
2   .p3. == .p32.  0.335  1   0.563
3   .p4. == .p33.  2.389  1   0.122
4   .p6. == .p35.  7.026  1   0.008
5   .p7. == .p36.  0.072  1   0.789
6   .p8. == .p37.  0.000  1   0.988
7  .p20. == .p49.  8.342  1   0.004
8  .p21. == .p50. 42.173  1   0.000
9  .p22. == .p51.  2.691  1   0.101
10 .p23. == .p52. 11.089  1   0.001</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameterTable</span>(m_scal2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="step-3-partial-scalar-invariance" class="level2">
<h2 class="anchored" data-anchor-id="step-3-partial-scalar-invariance">Step 3 — Partial scalar invariance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: free the intercept of Sim</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>m_scal2_p <span class="ot">&lt;-</span> <span class="fu">cfa</span>(model, <span class="at">data =</span> dmg, <span class="at">group =</span> <span class="st">"diagnosis"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">group.equal =</span> <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">group.partial =</span> <span class="st">"Sim ~ 1"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal2_p, <span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"tli"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi     tli 
100.174  49.000   0.083   0.957   0.950 </code></pre>
</div>
</div>
<hr>
</section>
<section id="step-3-partial-scalar-invariance-1" class="level2">
<h2 class="anchored" data-anchor-id="step-3-partial-scalar-invariance-1">Step 3 — Partial scalar invariance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_scal2_p, m_metr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

          Df   AIC   BIC   Chisq Chisq diff    RMSEA Df diff Pr(&gt;Chisq)  
m_metr2   44 11243 11406  88.153                                         
m_scal2_p 49 11245 11389 100.174     12.021 0.096752       5     0.0345 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m_scal2_p, <span class="st">"cfi"</span>) <span class="sc">-</span> <span class="fu">fitMeasures</span>(m_metr2, <span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.006 </code></pre>
</div>
</div>
<hr>
</section>
<section id="what-does-partial-scalar-mean-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="what-does-partial-scalar-mean-interpretation">What does partial scalar mean (interpretation)?</h2>
<ul>
<li>Most intercepts are comparable across groups</li>
<li>A small subset is not (e.g., <code>Sim</code>)</li>
<li>Latent mean comparisons can be <em>more defensible</em> under partial scalar, but interpret non-invariant indicators substantively</li>
</ul>
<blockquote class="blockquote">
<p>Which item behaves differently across groups, and what could it reflect?</p>
</blockquote>
</section>
<section id="invariance-of-residuals-of-observed-variables1" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-residuals-of-observed-variables1">Invariance of Residuals of observed variables(1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: parameter "Sim~1" remains free</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>m.rvo<span class="ot">=</span><span class="fu">cfa</span>(model,dmg,<span class="at">group=</span><span class="st">"diagnosis"</span>,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.equal=</span><span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>,<span class="st">"residuals"</span>),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.partial=</span><span class="st">"Sim~1"</span>) <span class="co">#Note that this is still here</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspection of fit indices</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo,<span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"nnfi"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi    nnfi 
127.344  57.000   0.091   0.940   0.941 </code></pre>
</div>
</div>
</section>
<section id="invariance-of-residuals-of-observed-variables-2" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-residuals-of-observed-variables-2">Invariance of Residuals of observed variables (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.rvo,m_scal2_p) <span class="co"># Note: Comparison model Partial Scalar invariance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

          Df   AIC   BIC  Chisq Chisq diff   RMSEA Df diff Pr(&gt;Chisq)    
m_scal2_p 49 11245 11389 100.17                                          
m.rvo     57 11256 11371 127.34     27.169 0.12639       8  0.0006609 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo,<span class="st">"cfi"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m_scal2_p,<span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.016 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo,<span class="st">"bic"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m_scal2_p,<span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    bic 
-18.461 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The Invariance of Residuals of observed variables</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   is not satisfactory. Let's take a look at equality constraints</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspection-of-equality-constraints" class="level2">
<h2 class="anchored" data-anchor-id="inspection-of-equality-constraints">Inspection of equality constraints</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lavTestScore</span>(m.rvo)<span class="sc">$</span>uni <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
univariate score tests:

     lhs op   rhs     X2 df p.value
1   .p2. == .p31.  4.802  1   0.028
2   .p3. == .p32.  1.156  1   0.282
3   .p4. == .p33.  0.138  1   0.710
4   .p6. == .p35.  7.948  1   0.005
5   .p7. == .p36.  0.099  1   0.753
6   .p8. == .p37.  0.020  1   0.888
7   .p9. == .p38.  0.107  1   0.744
8  .p10. == .p39.  0.108  1   0.743
9  .p11. == .p40.  0.504  1   0.478
10 .p12. == .p41. 12.169  1   0.000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (... see complete output )</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># From a first analysis, we can see that</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  the residuals of variables  “Comp” and “PicComp”</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  have Modification indices that are</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  particularly high, so let's free them</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="invariance-of-residuals-of-observed-variables-1" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-residuals-of-observed-variables-1">Invariance of Residuals of observed variables (1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>m.rvo.P<span class="ot">=</span><span class="fu">cfa</span>(model,dmg,<span class="at">group=</span><span class="st">"diagnosis"</span>,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">group.equal=</span><span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>,<span class="st">"residuals"</span>),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">group.partial=</span><span class="fu">c</span>(<span class="st">"Sim~1"</span>,<span class="st">"PicComp~~PicComp"</span>,<span class="st">"Comp~~Comp"</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit indices</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo.P,<span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"nnfi"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi    nnfi 
102.420  55.000   0.076   0.960   0.959 </code></pre>
</div>
</div>
</section>
<section id="partial-invariance-of-residuals-of-observed-variables-2" class="level2">
<h2 class="anchored" data-anchor-id="partial-invariance-of-residuals-of-observed-variables-2">Partial Invariance of Residuals of observed variables (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluation of Partial Invariance of Residuals of observed variables</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.rvo.P,m_scal2_p) <span class="co"># Note: Comparison model Partial Scalar invariance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

          Df   AIC   BIC  Chisq Chisq diff RMSEA Df diff Pr(&gt;Chisq)
m_scal2_p 49 11245 11389 100.17                                    
m.rvo.P   55 11235 11357 102.42     2.2458     0       6     0.8958</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo.P,<span class="st">"cfi"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m_scal2_p,<span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cfi 
0.003 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.rvo.P,<span class="st">"bic"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m_scal2_p,<span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    bic 
-31.977 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Paartial Invariance of Residuals of observed variables is satisfactory.</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Question: What can we say about overall</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Measurement Invariance of the baseline theoretical model?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="invariance-of-variance-of-latent-variables-1" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-variance-of-latent-variables-1">Invariance of Variance of latent variables (1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>m.vvl<span class="ot">=</span><span class="fu">cfa</span>(model,dmg,<span class="at">group=</span><span class="st">"diagnosis"</span>,</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.equal=</span><span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>,<span class="st">"residuals"</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"lv.variances"</span>),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.partial=</span><span class="fu">c</span>(<span class="st">"Sim~1"</span>,<span class="st">"PicComp~~PicComp"</span>,<span class="st">"Comp~~Comp"</span>))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit indices</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.vvl,<span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"nnfi"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi    nnfi 
105.825  57.000   0.076   0.959   0.959 </code></pre>
</div>
</div>
</section>
<section id="invariance-of-variance-of-latent-variables-2" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-variance-of-latent-variables-2">Invariance of Variance of latent variables (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.vvl,m.rvo.P)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

        Df   AIC   BIC  Chisq Chisq diff    RMSEA Df diff Pr(&gt;Chisq)
m.rvo.P 55 11235 11357 102.42                                       
m.vvl   57 11234 11349 105.83     3.4056 0.068449       2     0.1822</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.vvl,<span class="st">"cfi"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.rvo.P,<span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.001 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.vvl,<span class="st">"bic"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.rvo.P,<span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bic 
-8.002 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OK, this looks good!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="invariance-of-covariance-of-latent-variables-1" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-covariance-of-latent-variables-1">Invariance of Covariance of latent variables (1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>m.cvl<span class="ot">=</span><span class="fu">cfa</span>(model,dmg,<span class="at">group=</span><span class="st">"diagnosis"</span>,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.equal=</span><span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                        ,<span class="st">"residuals"</span>,<span class="st">"lv.variances"</span>,<span class="st">"lv.covariances"</span>),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.partial=</span><span class="fu">c</span>(<span class="st">"Sim~1"</span>,<span class="st">"PicComp~~PicComp"</span>,<span class="st">"Comp~~Comp"</span>))</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit indices</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.cvl,<span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"nnfi"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi    nnfi 
106.412  58.000   0.075   0.959   0.960 </code></pre>
</div>
</div>
</section>
<section id="invariance-of-covariance-of-latent-variables2" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-covariance-of-latent-variables2">Invariance of Covariance of latent variables(2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.cvl,m.vvl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

      Df   AIC   BIC  Chisq Chisq diff RMSEA Df diff Pr(&gt;Chisq)
m.vvl 57 11234 11349 105.83                                    
m.cvl 58 11233 11344 106.41    0.58642     0       1     0.4438</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.cvl,<span class="st">"cfi"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.vvl,<span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>cfi 
  0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.cvl,<span class="st">"bic"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.vvl,<span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bic 
-5.117 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OK, we're almost there!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="invariance-of-means-of-latent-variables-1" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-means-of-latent-variables-1">Invariance of Means of latent variables (1)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># last step</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>m.med<span class="ot">=</span><span class="fu">cfa</span>(model,dmg,<span class="at">group=</span><span class="st">"diagnosis"</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.equal=</span><span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                        ,<span class="st">"residuals"</span>,<span class="st">"lv.variances"</span>,<span class="st">"lv.covariances"</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"means"</span>),</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">group.partial=</span><span class="fu">c</span>(<span class="st">"Sim~1"</span>,<span class="st">"PicComp~~PicComp"</span>,<span class="st">"Comp~~Comp"</span>))</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit indices</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.med,<span class="fu">c</span>(<span class="st">"chisq"</span>,<span class="st">"df"</span>,<span class="st">"rmsea"</span>,<span class="st">"cfi"</span>,<span class="st">"nnfi"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  chisq      df   rmsea     cfi    nnfi 
110.933  60.000   0.075   0.957   0.960 </code></pre>
</div>
</div>
</section>
<section id="invariance-of-means-of-latent-variables-2" class="level2">
<h2 class="anchored" data-anchor-id="invariance-of-means-of-latent-variables-2">Invariance of Means of latent variables (2)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m.med,m.cvl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Chi-Squared Difference Test

      Df   AIC   BIC  Chisq Chisq diff    RMSEA Df diff Pr(&gt;Chisq)
m.cvl 58 11233 11344 106.41                                       
m.med 60 11234 11337 110.93     4.5212 0.091673       2     0.1043</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.med,<span class="st">"cfi"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.cvl,<span class="st">"cfi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cfi 
-0.002 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitMeasures</span>(m.med,<span class="st">"bic"</span>)<span class="sc">-</span><span class="fu">fitMeasures</span>(m.cvl,<span class="st">"bic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   bic 
-6.886 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This last model is also satisfactory</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANY COMMENTS?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summing-up" class="level2">
<h2 class="anchored" data-anchor-id="summing-up">Summing up</h2>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">Models</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">npar</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">df</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">chisq</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">cfi</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">tli</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">nnfi</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">agfi</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">srmr</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">rmsea</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">bic</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold;">aic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Manics</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">54.05</td>
<td style="text-align: left;">0.95</td>
<td style="text-align: left;">0.92</td>
<td style="text-align: left;">0.92</td>
<td style="text-align: left;">0.84</td>
<td style="text-align: left;">0.05</td>
<td style="text-align: left;">0.11</td>
<td style="text-align: left;">5590.65</td>
<td style="text-align: left;">5539.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">Norming</td>
<td style="text-align: left;">17</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;">18.15</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">0.94</td>
<td style="text-align: left;">0.03</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">5718.64</td>
<td style="text-align: left;">5667.46</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Configural</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">72.2</td>
<td style="text-align: left;">0.97</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.04</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11424.11</td>
<td style="text-align: left;">11238.93</td>
</tr>
<tr class="even">
<td style="text-align: left;">Metric</td>
<td style="text-align: left;">44</td>
<td style="text-align: left;">44</td>
<td style="text-align: left;">88.15</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.95</td>
<td style="text-align: left;">0.95</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.06</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11405.84</td>
<td style="text-align: left;">11242.88</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scalar</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">50</td>
<td style="text-align: left;">144.67</td>
<td style="text-align: left;">0.92</td>
<td style="text-align: left;">0.91</td>
<td style="text-align: left;">0.91</td>
<td style="text-align: left;">0.97</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.11</td>
<td style="text-align: left;">11428.13</td>
<td style="text-align: left;">11287.39</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scalar Partial</td>
<td style="text-align: left;">39</td>
<td style="text-align: left;">49</td>
<td style="text-align: left;">100.17</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.95</td>
<td style="text-align: left;">0.95</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.07</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11389.34</td>
<td style="text-align: left;">11244.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residual Variances</td>
<td style="text-align: left;">31</td>
<td style="text-align: left;">57</td>
<td style="text-align: left;">127.34</td>
<td style="text-align: left;">0.94</td>
<td style="text-align: left;">0.94</td>
<td style="text-align: left;">0.94</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">11370.88</td>
<td style="text-align: left;">11256.07</td>
</tr>
<tr class="even">
<td style="text-align: left;">Residual Variances Partial</td>
<td style="text-align: left;">33</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">102.42</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.07</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11357.37</td>
<td style="text-align: left;">11235.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Latent Variances</td>
<td style="text-align: left;">31</td>
<td style="text-align: left;">57</td>
<td style="text-align: left;">105.83</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11349.36</td>
<td style="text-align: left;">11234.55</td>
</tr>
<tr class="even">
<td style="text-align: left;">Latent Covariances</td>
<td style="text-align: left;">30</td>
<td style="text-align: left;">58</td>
<td style="text-align: left;">106.41</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0.07</td>
<td style="text-align: left;">11344.25</td>
<td style="text-align: left;">11233.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Latent Means</td>
<td style="text-align: left;">28</td>
<td style="text-align: left;">60</td>
<td style="text-align: left;">110.93</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.96</td>
<td style="text-align: left;">0.98</td>
<td style="text-align: left;">0.09</td>
<td style="text-align: left;">0.08</td>
<td style="text-align: left;">11337.36</td>
<td style="text-align: left;">11233.66</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
</section>
<section id="structural-invariance" class="level2">
<h2 class="anchored" data-anchor-id="structural-invariance">Structural invariance</h2>
<p>Test of multigroup invariance can also be used to compare differences in the regression coefficients of two or more groups (interactions).</p>
<p><img src="../assets/images/regressions.png" class="img-fluid" style="width:78.0%"></p>
<hr>
</section>
<section id="exercise-connect-to-the-lab" class="level2">
<h2 class="anchored" data-anchor-id="exercise-connect-to-the-lab">Exercise (connect to the lab)</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Try it (15–25 min)</strong><br>
1. Fit configural, metric, scalar on the toy dataset <code>d</code>.<br>
2. Decide whether scalar is acceptable using ΔCFI + theory.<br>
3. If scalar fails, free <strong>one</strong> intercept using <code>group.partial</code>.<br>
4. Write 3–4 sentences: <em>what is comparable now, and what is not?</em></p>
</div>
</div>
<blockquote class="blockquote">
<p><span style="color:red">Lab link placeholder: add a direct link to the invariance lab once created (e.g., <code>../labs/lab04_invariance.qmd</code>).</span></p>
</blockquote>
<hr>
</section>
<section id="take-home-3-things" class="level2">
<h2 class="anchored" data-anchor-id="take-home-3-things">Take-home: 3 things</h2>
<ol type="1">
<li>Invariance is about <strong>comparability</strong><br>
</li>
<li><strong>Scalar (full/partial)</strong> is the key for latent mean comparisons.<br>
</li>
<li>Partial invariance is legitimate, but must be <strong>disciplined + theory-driven</strong>.</li>
</ol>
<hr>
</section>
<section id="further-reading-extras" class="level2">
<h2 class="anchored" data-anchor-id="further-reading-extras">Further reading (extras)</h2>
<ul>
<li>Partial invariance strategies and interpretability<br>
</li>
<li>Invariance with ordinal indicators (thresholds first)<br>
</li>
<li>Robust difference testing with MLR / WLSMV</li>
</ul>
<blockquote class="blockquote">
<p><span style="color:red">Add links to <code>extras/</code> modules when we create them.</span></p>
</blockquote>
<hr>
</section>
<section id="references" class="level2 tiny">
<h2 class="tiny anchored" data-anchor-id="references">References</h2>
<div id="refs" role="list">

</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>